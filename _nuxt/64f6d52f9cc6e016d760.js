(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{437:function(n,t,e){"use strict";t.a=[{aid:"work-in-do1",title:"二零一八",date:"20190214",tags:["work"],desc:"关于2018年这一年来的工作痕迹"},{aid:"webpack-optimization",title:"webpack构建速度优化",date:"20180704",tags:["webpack"],desc:"实践是检验真理的唯一标准"},{aid:"trap-in-job",title:"项目中遇到的坑...",date:"20180711",tags:["webpack"],desc:"关于升级到webpack4.x遇到的问题"},{aid:"prerender-spa-plugin",title:"单页面预渲染实践",date:"20181205",tags:["webpack"],desc:"通过prerender-spa-plugin实现单页面预渲染"}]},438:function(n,t,e){n.exports=e.p+"img/489ced3.jpg"},439:function(n,t,e){"use strict";e(74),e(26),e(27),e(17);var a=e(76),i=e.n(a),c={save:function(n,t){var e=new(i.a.Object.extend(n));return t&&t.map(function(n){e.set(n.key,n.value)}),new Promise(function(n,t){e.save().then(function(t){var e={oid:t.id,data:t.attributes};n(e)},function(n){t(n)})})},select:{contains:function(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=new i.a.Query(n);return c.contains(t.key,t.value),c.limit(e),a&&c.skip(a),this.core(c)},greaterThanOrEqualTo:function(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=new i.a.Query(n);return c.greaterThanOrEqualTo(t.key,t.value),c.limit(e),a&&c.skip(a),this.core(c)},equalTo:function(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"descending",s=new i.a.Query(n);if(t instanceof Array){var l=!0,o=!1,u=void 0;try{for(var v,d=t[Symbol.iterator]();!(l=(v=d.next()).done);l=!0){var h=v.value;s.equalTo(h.key,h.value)}}catch(n){o=!0,u=n}finally{try{l||null==d.return||d.return()}finally{if(o)throw u}}}else s.equalTo(t.key,t.value);return s[c]("createdAt"),s.limit(e),a&&s.skip(a),this.core(s)},countTotal:function(n,t){var e=new i.a.Query(n);if(t instanceof Array){var a=!0,c=!1,s=void 0;try{for(var l,o=t[Symbol.iterator]();!(a=(l=o.next()).done);a=!0){var u=l.value;e.equalTo(u.key,u.value)}}catch(n){c=!0,s=n}finally{try{a||null==o.return||o.return()}finally{if(c)throw s}}}else e.equalTo(t.key,t.value);return new Promise(function(n,t){e.count().then(function(t){n(t)},function(n){t(n)})})},core:function(n){return new Promise(function(t,e){n.find().then(function(n){var e={};e=n.length>0?{ok:!0,data:n.map(function(n){return{oid:n.id,attributes:n.attributes,updatedAt:n.updatedAt.toLocaleString()}})}:{ok:!1},t(e)},function(n){e(n)})})}},update:function(n,t,e){var a=i.a.Object.createWithoutData(n,t);e.map(function(n){a.set(n.key,n.value)}),a.save()},count:function(n,t,e){return new Promise(function(a,c){var s=i.a.Object.createWithoutData(n,t);s.set(e.key,e.value),s.save().then(function(n){return n.increment(e.key,1),n.fetchWhenSave(!0),n.save()}).then(function(n){console.log(123333,n),a(n.attributes[e.key])},function(n){c(n)})})}};t.a=c},440:function(n,t,e){"use strict";e.d(t,"a",function(){return a}),e.d(t,"b",function(){return i}),e.d(t,"c",function(){return c});var a="Articles",i="Comments",c="Likes"},449:function(n,t,e){"use strict";e.r(t);e(17),e(75);var a=e(12),i=e.n(a),c=e(6),s=e.n(c),l=(e(56),e(13)),o=e.n(l),u=e(443),v=e.n(u),d=e(40),h=e(77),f=e(439),g=e(437),m=e(440),k={name:"articles-details",asyncData:function(){var n=o()(regeneratorRuntime.mark(function n(t){var e;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=t.params,n.abrupt("return",{article:g.a.filter(function(n){return n.aid===e.id})[0]});case 2:case"end":return n.stop()}},n,this)}));return function(t){return n.apply(this,arguments)}}(),data:function(){return{oid:{articlesTable:null,commentsTable:null,likesTable:null},toc:{data:[],index:0,levelIndex:0,lastLevel:null,topLevel:null},content:{toc:null,markdown:""},likes:0,comment:null,commentList:[],pagination:{total:0},isLoadingContent:!1,isLoadingComments:!1,isLiked:!1}},created:function(){this.lcQueryArticlesById(),this.lcCountCommentsTotal(),this.lcQueryComments(1,10),this.lcQueryLikes()},beforeMount:function(){var n=this;this.getMarkdownFile();var t=new v.a.Renderer;t.heading=function(t,e,a){var i=n.tocAdd(t,e);return"<a id=".concat(i,' class="anchor-fix"></a><h').concat(e,">").concat(t,"</h").concat(e,">\n")},v.a.setOptions({renderer:t})},beforeDestroy:function(){this.$store.commit("articles/setPageView","--"),this.$store.commit("articles/setPageCollection",!1)},computed:s()({},Object(d.b)(["isAuthenticated","loggedUser"]),{hasComments:function(){return this.commentList.length>0}}),methods:{tocAdd:function(n,t){var e=this.toc,a=e.index,i=e.lastLevel,c=e.topLevel;this.toc.index=i===t?a:0,c&&c!==t||(this.toc.levelIndex++,this.toc.topLevel=t),this.toc.lastLevel=t;var s=this.toc.levelIndex,l="toc".concat(t).concat(s).concat(++this.toc.index);return this.toc.data.push({anchor:l,level:t,text:n,index:s}),l},tocToHtml:function(){for(var n=this.toc.data,t=[],e=0;e<n.length;e++){var a=n[e].index;t[a-1]?t[a-1].children.push(n[e]):t[a-1]=s()({},n[e],{children:[]})}this.content.toc=t,console.log(899,t)},getMarkdownFile:function(){var n=this;this.isLoadingContent=!0;var t="/posts/".concat(this.$route.params.id,"/index.md");this.$axios.get(t).then(function(t){n.isLoadingContent=!1,n.content.markdown=v()(t.data),n.tocToHtml()}).catch(function(t){n.isLoadingContent=!1,console.log(t)})},handleLoginInGithub:function(){var n=Object(h.a)().authorizeURL;window.open(n,"_blank","titlebar=false, status=false, location=false, toolbar=false, scrollbars=false, width=500, height=720")},handleLike:function(){var n=this;if(this.isAuthenticated){var t=this.$route.params.id;this.isLiked?this.$gnoz.alertMsg("嘻嘻，赞了不给取消！"):f.a.select.equalTo(m.a,{key:"aid",value:t}).then(function(t){if(t.ok){var e=t.data[0],a=e.oid,i=e.attributes;n.lcCountArticle(a,i.likes,"likes").then(function(t){f.a.update(m.c,n.oid.likesTable,[{key:"isLiked",value:!0}]),n.likes=t,n.isLiked=!0})}})}else this.$gnoz.alertMsg("请先登录！","warning")},handleComment:function(){var n=this;this.oid&&this.comment&&f.a.save(m.b,[{key:"aid",value:this.$route.params.id},{key:"comment",value:this.comment}].concat(i()(Object.keys(this.loggedUser).map(function(t){return{key:t,value:n.loggedUser[t]}})))).then(function(t){n.$gnoz.alertMsg("评论成功！"),n.comment=null,n.lcCountCommentsTotal(),n.lcQueryComments(1,10)}).catch(function(t){n.$gnoz.alertMsg("评论失败！","danger")})},lcQueryArticlesById:function(){var n=this,t=this.$route.params.id;f.a.select.equalTo(m.a,{key:"aid",value:t}).then(function(t){if(t.ok){var e=t.data[0],a=e.oid,i=e.attributes;n.lcCountArticle(a,i.pv,"pv").then(function(t){n.$store.commit("articles/setPageView",t)}),n.oid.articlesTable=a,n.likes=i.likes}else n.lcSaveArticle()})},lcCountCommentsTotal:function(){var n=this,t=this.$route.params.id;f.a.select.countTotal(m.b,{key:"aid",value:t}).then(function(t){n.pagination.total=t})},lcQueryComments:function(n){var t=this,e=n.currentPage,a=n.pageSize;e--,this.isLoadingComments=!0;var i=this.$route.params.id;f.a.select.equalTo(m.b,{key:"aid",value:i},a,e*a).then(function(n){t.isLoadingComments=!1,n.ok&&(t.commentList=n.data.map(function(n){return s()({},n.attributes,{updatedAt:n.updatedAt})}))})},lcQueryLikes:function(){var n=this;if(this.isAuthenticated){var t=this.$route.params.id;f.a.select.equalTo(m.c,[{key:"aid",value:t},{key:"userId",value:this.loggedUser.id}]).then(function(e){if(e.ok){var a=e.data[0].oid,i=e.data[0].attributes,c=i.isLiked,s=i.isCollected;n.oid.likesTable=a,n.isLiked=c,n.$store.commit("articles/setPageCollection",s),n.$store.commit("articles/setLikesTableOid",a)}else f.a.save(m.c,[{key:"aid",value:t},{key:"userId",value:n.loggedUser.id},{key:"isLiked",value:!1},{key:"isCollected",value:!1}]).then(function(t){var e=t.oid;n.oid.likesTable=e,n.$store.commit("articles/setLikesTableOid",e)})})}},lcCountArticle:function(n,t,e){return f.a.count(m.a,n,{key:e,value:t})},lcSaveArticle:function(){var n=this;f.a.save(m.a,[].concat(i()(Object.keys(this.article).map(function(t){return{key:t,value:n.article[t]}})),[{key:"pv",value:1},{key:"likes",value:0}]))}}},r=e(1),y=Object(r.a)(k,function(){var n=this,t=n.$createElement,a=n._self._c||t;return a("div",{staticClass:"article_details"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:{isLoading:n.isLoadingContent,title:"加载中···"},expression:"{isLoading: isLoadingContent, title: '加载中···'}"}]},[a("div",{directives:[{name:"highlight",rawName:"v-highlight"}],staticClass:"markdown_content",domProps:{innerHTML:n._s(n.content.markdown)}}),n._v(" "),a("div",{staticClass:"markdown_toc"},[n.content.toc?a("ul",{staticClass:"markdown_toc_first"},n._l(n.content.toc,function(t){return a("li",{key:t.anchor},[a("a",{attrs:{href:"#"+t.anchor}},[n._v(n._s(t.text))]),n._v(" "),t.children.length>0?a("ul",{staticClass:"markdown_toc_second"},n._l(t.children,function(t){return a("li",{key:t.anchor},[a("a",{attrs:{href:"#"+t.anchor}},[n._v("\n                "+n._s(t.text)+"\n              ")])])}),0):n._e()])}),0):n._e()])]),n._v(" "),a("div",{staticClass:"actions_content"},[a("dy-button",{attrs:{type:"danger",size:"large",outline:""},on:{click:n.handleLike}},[a("i",{staticClass:"fa",class:n.isLiked?"fa-heart":"fa-heart-o"}),n._v(" "),a("span",{staticStyle:{"margin-right":"10px"}},[n._v("喜欢")]),n._v("\n      "+n._s(n.likes)+"\n    ")]),n._v(" "),a("dy-button",{attrs:{type:"warning",size:"large"}},[a("i",{staticClass:"fa fa-rmb"}),n._v("\n      支持\n    ")])],1),n._v(" "),a("div",{staticClass:"comments_content"},[a("dy-row",[a("dy-col",{attrs:{span:"2"}},[n.isAuthenticated?a("img",{attrs:{src:n.loggedUser.avatar_url,alt:"avatar"}}):a("img",{attrs:{src:e(438),alt:"avatar"}})]),n._v(" "),a("dy-col",{attrs:{span:"22"}},[a("dy-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",maxlength:"140",placeholder:"到此一游？",disabled:!n.isAuthenticated,rows:"6"},model:{value:n.comment,callback:function(t){n.comment="string"==typeof t?t.trim():t},expression:"comment"}})],1),n._v(" "),a("dy-col",{staticStyle:{"text-align":"right"},attrs:{span:"24"}},[n.isAuthenticated?a("dy-button",{attrs:{type:"primary"},on:{click:n.handleComment}},[n._v("评论")]):a("dy-button",{attrs:{type:"danger"},on:{click:n.handleLoginInGithub}},[n._v("登录后可评论")])],1)],1),n._v(" "),a("h3",[n._v("\n      全部评论\n      "),a("span",[n._v(n._s(n.pagination.total)+"条")])]),n._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:{isLoading:n.isLoadingComments,title:"评论加载中···"},expression:"{isLoading: isLoadingComments, title: '评论加载中···'}"}]},[a("ul",{staticClass:"comments_content_list"},[n.hasComments?n._e():a("li",{staticClass:"t-empty-data"},[a("dy-icon",{attrs:{type:"no-data"}}),n._v(" "),a("p",[n._v("暂无评论")])],1),n._v(" "),n._l(n.commentList,function(t,e){return a("li",{key:e},[a("div",[a("img",{attrs:{src:t.avatar_url,alt:"avatar"}}),n._v(" "),a("span",[n._v(n._s(t.name))]),n._v(" "),a("time",[n._v(n._s(t.updatedAt))])]),n._v(" "),a("div",{staticClass:"comments_content_details"},[n._v(n._s(t.comment))])])})],2),n._v(" "),n.hasComments?a("dy-pagination",{attrs:{"show-page-size":"",total:n.pagination.total},on:{"page-change":n.lcQueryComments}}):n._e()],1)],1)])},[],!1,null,null,null);y.options.__file="_id.vue";t.default=y.exports}}]);